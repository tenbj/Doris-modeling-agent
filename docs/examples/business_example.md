# 电商用户订单分析业务需求文档（示例）

## 一、业务背景

### 1.1 项目背景
随着电商业务的快速发展，公司需要建立完善的数据分析体系，实时掌握用户购买行为、商品销售情况，为运营决策提供数据支撑。

### 1.2 业务目标
1. 建立用户行为分析体系，支持用户画像和精准营销
2. 实时监控销售数据，支持GMV、订单量等核心指标分析
3. 支持多维度下钻分析（用户等级、商品类目、地区等）
4. 追踪用户等级变化历史，支持用户成长分析

## 二、业务场景

### 2.1 运营分析场景
- **每日销售看板**：展示当日GMV、订单量、客单价、下单用户数等核心指标
- **用户分析报表**：按用户等级、注册渠道分析用户价值
- **商品分析报表**：按类目、品牌分析商品销售情况
- **地区分析报表**：按省市分析销售分布

### 2.2 用户运营场景
- **用户等级管理**：根据消费金额自动调整用户等级（普通→VIP→SVIP）
- **用户成长追踪**：追踪用户等级变化历史，分析用户成长路径
- **精准营销**：基于用户画像进行精准推送

### 2.3 商品运营场景
- **商品销售排行**：TOP销售商品、滞销商品分析
- **价格分析**：商品价格变化对销售的影响
- **库存预警**：根据销售趋势预警库存不足

## 三、核心业务实体

### 3.1 用户（User）
- **用户ID**：唯一标识
- **用户姓名**：用户真实姓名
- **用户等级**：普通、VIP、SVIP（会随消费金额变化）
- **用户状态**：活跃、沉睡、流失（会随行为变化）
- **注册渠道**：APP、小程序、PC
- **注册时间**：用户注册时间

**变化特性**：
- 用户等级会根据累计消费金额变化：
  - 普通用户：累计消费 < 1万元
  - VIP用户：累计消费 1万-10万元
  - SVIP用户：累计消费 > 10万元
- 用户状态会根据最后购买时间变化：
  - 活跃：最近30天内有购买
  - 沉睡：30-90天未购买
  - 流失：超过90天未购买

**数据需求**：需要使用拉链表记录用户等级和状态的历史变化

### 3.2 订单（Order）
- **订单ID**：唯一标识
- **用户ID**：下单用户
- **订单金额**：订单总金额
- **订单状态**：待付款、已付款、已发货、已完成、已取消、已退款
- **下单时间**：订单创建时间
- **支付时间**：订单支付时间
- **收货地址**：省、市、区

### 3.3 订单明细（Order Detail）
- **明细ID**：唯一标识
- **订单ID**：所属订单
- **商品ID**：购买的商品
- **购买数量**：数量
- **商品单价**：单价
- **商品金额**：小计金额（数量 × 单价）

### 3.4 商品（Product）
- **商品ID**：唯一标识
- **商品名称**：商品名称
- **商品类目**：一级类目、二级类目
- **品牌**：商品品牌
- **商品价格**：售价（会变化）
- **上架状态**：上架、下架

**变化特性**：
- 商品价格会调整（促销、季节性调价）
- 商品类目可能调整
- 商品状态会变化

**数据需求**：需要使用拉链表记录商品信息的历史变化

### 3.5 地区（Region）
- **地区ID**：唯一标识
- **省份**：省
- **城市**：市
- **区县**：区/县
- **地区等级**：一线、二线、三线、四线

## 四、核心业务指标

### 4.1 交易类指标

| 指标名称 | 指标说明 | 计算公式 | 统计粒度 | 统计周期 |
|---------|---------|---------|---------|---------|
| GMV | 成交总额 | SUM(订单金额) WHERE 订单状态 IN ('已付款','已发货','已完成') | 天/用户/商品/地区 | 日/月/年 |
| 订单量 | 订单总数 | COUNT(DISTINCT 订单ID) WHERE 订单状态 IN ('已付款','已发货','已完成') | 天/用户/商品/地区 | 日/月/年 |
| 下单用户数 | 下单用户去重数 | COUNT(DISTINCT 用户ID) | 天 | 日/月/年 |
| 客单价 | 平均订单金额 | GMV / 订单量 | 天/用户等级 | 日/月/年 |
| 件单价 | 平均每件商品金额 | GMV / SUM(购买数量) | 商品/类目 | 日/月/年 |

### 4.2 用户类指标

| 指标名称 | 指标说明 | 计算公式 | 统计粒度 | 统计周期 |
|---------|---------|---------|---------|---------|
| 用户总数 | 累计注册用户数 | COUNT(DISTINCT 用户ID) | - | 累计 |
| 新增用户数 | 当日新注册用户数 | COUNT(DISTINCT 用户ID) WHERE 注册日期 = 目标日期 | 天 | 日 |
| 活跃用户数 | 当日有购买的用户数 | COUNT(DISTINCT 用户ID) WHERE 下单日期 = 目标日期 | 天 | 日 |
| 用户复购率 | 购买2次以上的用户占比 | COUNT(DISTINCT 用户ID WHERE 订单数 >= 2) / COUNT(DISTINCT 用户ID) | - | 月/年 |
| VIP用户数 | VIP等级用户数量 | COUNT(DISTINCT 用户ID) WHERE 用户等级 = 'VIP' | - | 日/月 |

### 4.3 商品类指标

| 指标名称 | 指标说明 | 计算公式 | 统计粒度 | 统计周期 |
|---------|---------|---------|---------|---------|
| 销售件数 | 商品销售数量 | SUM(购买数量) | 商品/类目 | 日/月 |
| 销售额 | 商品销售金额 | SUM(商品金额) | 商品/类目 | 日/月 |
| 动销率 | 有销售的商品占比 | COUNT(DISTINCT 有销售的商品ID) / COUNT(DISTINCT 商品ID) | 类目 | 月 |

## 五、业务规则

### 5.1 数据过滤规则
1. **订单状态过滤**：
   - 计算GMV时，只统计"已付款"、"已发货"、"已完成"状态的订单
   - 排除"待付款"、"已取消"、"已退款"的订单

2. **测试订单过滤**：
   - 排除测试用户（user_id < 10000）的订单
   - 排除金额为0的订单

### 5.2 数据计算规则
1. **订单金额计算**：
   - 订单金额 = SUM(订单明细金额)
   - 订单明细金额 = 商品单价 × 购买数量

2. **用户等级计算规则**：
   - 按用户累计消费金额（历史总GMV）划分：
     - 普通：< 10,000元
     - VIP：10,000 - 100,000元
     - SVIP：> 100,000元
   - 每日重新计算，如有变化则更新

3. **用户状态计算规则**：
   - 按最后购买时间距今天数判断：
     - 活跃：<= 30天
     - 沉睡：31-90天
     - 流失：> 90天
   - 每日重新计算，如有变化则更新

### 5.3 数据清洗规则
1. **异常订单处理**：
   - 订单金额 < 0 的，设置为0
   - 订单金额 > 100万的，标记为异常订单，需人工审核

2. **缺失值处理**：
   - 用户姓名为空的，填充为"匿名用户"
   - 收货地址缺失的，省市区填充为"未知"

3. **重复数据处理**：
   - 同一订单ID重复的，保留最后更新的记录

## 六、时间维度

### 6.1 业务日期
- **下单日期**：用户下单的日期，作为订单归属日期
- **支付日期**：用户支付的日期
- **完成日期**：订单完成的日期

**统计口径**：
- GMV等指标按**下单日期**统计
- 如订单跨天支付，仍归属到下单日期

### 6.2 统计周期
- **日报**：T+1产出，统计T日数据
- **月报**：每月1日产出，统计上月数据
- **年报**：每年1月1日产出，统计上年数据

### 6.3 数据保留
- **原始数据（ODS）**：保留7天
- **明细数据（DWD）**：保留90天
- **汇总数据（DWS）**：保留1年
- **应用数据（ADS）**：保留2年
- **维度数据（DIM）**：永久保留（含历史）

## 七、查询场景

### 7.1 实时查询场景
- 查询当日GMV实时数据（延迟5分钟内）
- 查询商品实时销售排行
- 查询用户最新等级和状态

### 7.2 历史查询场景
- 查询近30天GMV趋势
- 查询用户等级变化历史（拉链表查询）
- 查询某用户在2023年1月1日的用户等级（时间点查询）

### 7.3 多维分析场景
- 按用户等级、商品类目、地区下钻分析GMV
- 按注册渠道分析用户价值
- 按品牌分析商品销售情况

## 八、数据质量要求

### 8.1 完整性要求
- 订单ID、用户ID、商品ID不能为空
- 订单金额不能为NULL
- 订单明细金额之和 = 订单金额（误差 < 0.01元）

### 8.2 准确性要求
- 订单金额 >= 0（退款订单除外）
- 购买数量 > 0
- 支付时间 >= 下单时间
- 完成时间 >= 支付时间

### 8.3 一致性要求
- 订单表中的用户ID必须在用户维度表中存在
- 订单明细表中的商品ID必须在商品维度表中存在
- DWS汇总数据 = DWD明细数据聚合结果

### 8.4 及时性要求
- ODS层：T+0 1:00前完成
- DWD层：T+0 3:00前完成
- DWS层：T+0 5:00前完成
- ADS层：T+0 6:00前完成

## 九、数据分层需求

### 9.1 ODS层（原始数据层）
- ods_erp_order：订单原始数据
- ods_erp_order_detail：订单明细原始数据
- ods_crm_user：用户原始数据
- ods_pms_product：商品原始数据

### 9.2 DWD层（明细数据层）
- dwd_trade_order_detail：订单明细（清洗后，关联维度）
- dwd_user_behavior_log：用户行为日志（如需要）

### 9.3 DWS层（汇总数据层）
- dws_trade_user_order_1d：用户订单日汇总
- dws_trade_product_sales_1d：商品销售日汇总
- dws_trade_region_order_1d：地区订单日汇总

### 9.4 ADS层（应用数据层）
- ads_dashboard_gmv_summary：GMV看板汇总
- ads_operation_user_stat：用户运营统计报表

### 9.5 DIM层（维度层 - 使用拉链表）
- dim_user_info：用户信息维度（拉链表，追踪等级和状态变化）
- dim_product_info：商品信息维度（拉链表，追踪价格和类目变化）
- dim_region：地区维度（相对稳定，可不用拉链表）

## 十、特殊说明

### 10.1 用户维度拉链表
由于用户等级和状态会频繁变化，必须使用拉链表记录历史：

**应用场景**：
- 查询用户当前等级：`WHERE is_current = 1`
- 查询用户在2023-01-01的等级：`WHERE '2023-01-01' BETWEEN start_date AND end_date`
- 查询用户等级变化历史：`WHERE user_id = xxx ORDER BY start_date`

### 10.2 商品维度拉链表
商品价格和类目会调整，需要拉链表记录：

**应用场景**：
- 计算历史订单时，使用订单下单日期对应的商品价格
- 分析价格调整对销售的影响

### 10.3 性能要求
- GMV日报查询响应时间 < 3秒
- 用户订单明细查询（单用户）< 1秒
- 商品销售排行查询（TOP100）< 2秒

## 十一、附录

### 11.1 名词解释
- **GMV**：Gross Merchandise Volume，成交总额
- **客单价**：平均每个订单的金额
- **件单价**：平均每件商品的金额
- **复购率**：购买2次及以上的用户占比
- **动销率**：有销售的商品占比

### 11.2 联系人
- 需求提出人：运营部 张三
- 业务负责人：运营总监 李四
- 技术负责人：数据部 王五

---

**文档版本**：v1.0  
**创建日期**：2024-01-15  
**最后更新**：2024-01-15

